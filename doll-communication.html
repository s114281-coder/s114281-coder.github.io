<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURAL REACTION - éµç›¤ç‰ˆ</title>
    <style>
        :root {
            --bg: #050510;
            --neon-blue: #00d2ff;
            --neon-red: #ff0033;
            --neon-gold: #ffcc00;
            --neon-green: #39ff14;
        }

        body {
            background-color: var(--bg);
            background-image: linear-gradient(135deg, #050510 0%, #0d0d2b 100%);
            color: white;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            margin: 0; display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; overflow: hidden; user-select: none;
        }

        h1 {
            font-size: 3.2rem; margin: 30px 0; font-weight: 900;
            background: linear-gradient(to bottom, #fff, var(--neon-blue));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(0, 210, 255, 0.5));
            letter-spacing: 4px;
        }

        .container {
            width: 90%; max-width: 700px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 40px; padding: 40px; display: none;
            box-shadow: 0 30px 60px rgba(0,0,0,0.8);
        }
        .container.active { display: block !important; }

        /* --- è§’è‰²é¸æ“‡å¡ç‰‡ --- */
        .role-grid { display: flex; justify-content: space-around; gap: 15px; }
        .role-card {
            background: #111; border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; padding: 25px 15px; width: 150px; cursor: pointer;
            transition: 0.3s; text-align: center;
        }
        .role-card:hover { 
            border-color: var(--neon-blue); transform: scale(1.05); 
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.3); background: rgba(0, 210, 255, 0.05);
        }
        .char-circle { width: 60px; height: 60px; border-radius: 50%; margin: 0 auto 15px; box-shadow: 0 0 15px currentColor; }
        .role-name { font-size: 1.1rem; letter-spacing: 2px; font-weight: bold; }

        /* --- é›£åº¦æŒ‰éˆ• --- */
        .diff-group { display: flex; flex-direction: column; gap: 20px; }
        .diff-btn {
            position: relative; width: 100%; padding: 24px; font-size: 1.6rem;
            font-weight: 900; color: #fff; border: none; border-radius: 12px;
            cursor: pointer; transition: all 0.3s; overflow: hidden;
            letter-spacing: 4px; text-align: left; padding-left: 40px; background: #111;
        }
        .diff-btn::before { content: ''; position: absolute; left: 0; top: 0; width: 8px; height: 100%; background: currentColor; }
        .diff-btn:hover { transform: scale(1.02) translateX(10px); box-shadow: -10px 0 20px currentColor; background: rgba(255,255,255,0.05); }
        .b-easy { color: var(--neon-green); border: 1px solid rgba(57, 255, 20, 0.3); }
        .b-med { color: var(--neon-gold); border: 1px solid rgba(255, 204, 0, 0.3); }
        .b-hard { color: var(--neon-red); border: 1px solid rgba(255, 0, 51, 0.3); }
        .btn-subtext { display: block; font-size: 0.9rem; font-weight: 300; color: rgba(255,255,255,0.5); letter-spacing: 1px; margin-top: 4px; }

        /* --- éµç›¤éŠæˆ²èˆå° (ä¹å®®æ ¼) --- */
        #game-stage {
            width: 100%; height: 60vh; max-height: 600px;
            background: #020205; border-radius: 30px;
            border: 4px solid rgba(255,255,255,0.1); 
            position: relative; overflow: hidden;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.8);
            /* è¨­ç½®ç‚º 3x3 ç¶²æ ¼ */
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px;
            padding: 4px;
        }

        /* ç¶²æ ¼å–®å…ƒæ ¼ */
        .grid-cell {
            position: relative;
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 5rem;
            font-weight: 900;
            color: rgba(255,255,255,0.02); /* é è¨­è¶…æ·¡ */
            transition: 0.3s;
        }

        /* å•Ÿç”¨çš„å–®å…ƒæ ¼ (é¡¯ç¤ºæ•¸å­—) */
        .grid-cell.active-zone {
            color: rgba(255,255,255,0.15);
            border-color: rgba(0, 210, 255, 0.2);
            text-shadow: 0 0 20px var(--neon-blue);
        }

        /* æŒ‰å°æ™‚çš„é–ƒçˆ */
        .grid-cell.correct-hit {
            animation: flashGreen 0.3s ease-out;
        }
        @keyframes flashGreen { 0% { background: rgba(57, 255, 20, 0.5); } 100% { background: transparent; } }

        /* æŒ‰éŒ¯æ™‚èˆå°é–ƒçˆ */
        .stage-error { animation: flashRed 0.3s ease-out; }
        @keyframes flashRed { 0% { border-color: var(--neon-red); box-shadow: 0 0 50px var(--neon-red); } }

        /* ç›®æ¨™çƒé«” */
        #target { 
            width: 80px; height: 80px; border-radius: 50%; 
            position: absolute; display: none; z-index: 10; 
            border: 4px solid #fff; pointer-events: none; /* è®“æ»‘é¼ é»æ“Šç©¿é€ */
            transition: all 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* å¢åŠ ä¸€é»å½ˆæ€§ç§»å‹•æ„Ÿ */
        }

        .info-panel { display: flex; justify-content: space-around; font-size: 2.2rem; font-weight: 900; margin-bottom: 20px; }

        /* --- ğŸ’¥ åŠ åˆ†èˆ‡æ‰£åˆ†ç‰¹æ•ˆ --- */
        .popup-effect {
            position: absolute; font-size: 3rem; font-weight: 900;
            pointer-events: none; z-index: 101;
            animation: popupFloat 0.6s ease-out forwards;
            text-shadow: 0 0 15px currentColor;
        }
        .popup-miss { color: var(--neon-red); }
        .popup-hit { color: var(--neon-green); }
        @keyframes popupFloat {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            100% { opacity: 0; transform: translate(-50%, -150%) scale(1.5); }
        }

        /* çµç®— */
        #result-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        #result-box {
            background: #0a0a0a; padding: 50px; border-radius: 30px; text-align: center;
            border: 2px solid var(--neon-blue); box-shadow: 0 0 50px rgba(0, 210, 255, 0.2);
        }
    </style>
</head>
<body>

    <h1>NEURAL REACTION K-TYPE</h1>

    <div id="step1" class="container active">
        <p style="text-align:center; color: #555; text-transform: uppercase;">é¸æ“‡åƒè³½è§’è‰²</p>
        <div class="role-grid">
            <div class="role-card" onclick="setRole('gold')">
                <div class="char-circle" style="background: gold; color: gold;"></div>
                <div class="role-name">é»ƒé‡‘è‹±é›„</div>
            </div>
            <div class="role-card" onclick="setRole('cyan')">
                <div class="char-circle" style="background: cyan; color: cyan;"></div>
                <div class="role-name">é’è—å¿è€…</div>
            </div>
            <div class="role-card" onclick="setRole('magenta')">
                <div class="char-circle" style="background: #ff007f; color: #ff007f;"></div>
                <div class="role-name">æ¡ƒç´…åˆºå®¢</div>
            </div>
        </div>
    </div>

    <div id="step2" class="container">
        <p style="text-align:center; color: #555; text-transform: uppercase;">é¸æ“‡éµç›¤æ“æ§å€åŸŸ</p>
        <div class="diff-group">
            <button class="diff-btn b-easy" onclick="start(['1','2','4','5'], 900)">
                åˆç´šå€åŸŸ <span class="btn-subtext">æŒ‰éµ: 1, 2, 4, 5 (å·¦ä¸Šå››æ ¼)</span>
            </button>
            <button class="diff-btn b-med" onclick="start(['1','2','3','4','5','6'], 800)">
                ä¸­ç´šæ“´å±• <span class="btn-subtext">æŒ‰éµ: 1 ~ 6 (ä¸Šæ–¹å…©æ’)</span>
            </button>
            <button class="diff-btn b-hard" onclick="start(['1','2','3','4','5','6','7','8','9'], 700)">
                é«˜ç´šå…¨é–‹ <span class="btn-subtext">æŒ‰éµ: 1 ~ 9 (å®Œæ•´ä¹å®®æ ¼)</span>
            </button>
        </div>
    </div>

    <div id="step3" class="container" style="max-width: 900px;">
        <div class="info-panel">
            <span style="color:var(--neon-red);">TIME: <span id="timer">--</span></span>
            <span style="color:var(--neon-blue);">SCORE: <span id="score">0</span>/7</span>
        </div>
        <div id="game-stage"></div>
        <div id="target"></div>
    </div>

    <div id="result-overlay">
        <div id="result-box">
            <h2 id="res-title" style="font-size: 3rem;"></h2>
            <p id="res-msg" style="font-size: 1.4rem; color: #888; margin-bottom: 30px;"></p>
            <button style="background:var(--neon-blue); border:none; padding:15px 40px; font-weight:bold; cursor:pointer; border-radius:5px;" onclick="location.reload()">é‡å•Ÿç³»çµ±</button>
        </div>
    </script>

    <script>
        let pColor = "", pScore = 0, pTime = 35;
        let active = false, moveTimer;
        let allowedKeys = []; // ç•¶å‰é›£åº¦å…è¨±çš„æŒ‰éµ
        let currentTargetKey = ""; // ç›®å‰çƒæ‰€åœ¨çš„ç›®æ¨™æŒ‰éµ

        // åˆå§‹åŒ–ç¶²æ ¼
        function initGrid() {
            const stage = document.getElementById('game-stage');
            stage.innerHTML = ''; // æ¸…ç©º
            for (let i = 1; i <= 9; i++) {
                let cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.id = 'cell-' + i;
                cell.innerText = i; // èƒŒæ™¯æ•¸å­—
                stage.appendChild(cell);
            }
        }
        initGrid(); // é é¢åŠ è¼‰æ™‚å…ˆåˆå§‹åŒ–

        function setRole(c) {
            pColor = (c === 'magenta') ? '#ff007f' : c;
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step2').classList.add('active');
        }

        function start(keys, speed) {
            allowedKeys = keys;
            pScore = 0; active = true;
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
            
            // é»äº®å°æ‡‰é›£åº¦çš„æ ¼å­
            document.querySelectorAll('.grid-cell').forEach(cell => {
                if (allowedKeys.includes(cell.innerText)) {
                    cell.classList.add('active-zone');
                }
            });

            const ball = document.getElementById('target');
            ball.style.backgroundColor = pColor;
            ball.style.boxShadow = `0 0 40px ${pColor}, inset 0 0 10px #fff`;
            ball.style.display = 'block';

            const countdown = setInterval(() => {
                pTime--; document.getElementById('timer').innerText = pTime;
                if (pTime <= 0) { clearInterval(countdown); if (active) end(false); }
            }, 1000);
            jump(speed);
        }

        function jump(speed) {
            if (!active) return;
            
            // 1. å¾å…è¨±çš„æŒ‰éµä¸­éš¨æ©ŸæŒ‘é¸ä¸€å€‹
            const randomIndex = Math.floor(Math.random() * allowedKeys.length);
            currentTargetKey = allowedKeys[randomIndex];

            // 2. æ‰¾åˆ°å°æ‡‰çš„æ ¼å­å…ƒç´ 
            const targetCell = document.getElementById('cell-' + currentTargetKey);
            const stage = document.getElementById('game-stage');
            const ball = document.getElementById('target');

            // 3. è¨ˆç®—æ ¼å­ç›¸å°æ–¼èˆå°çš„ä½ç½®å’Œå¤§å°
            // é€™è£¡éœ€è¦è€ƒæ…®èˆå°çš„ margin/paddingï¼Œä½¿ç”¨ç›¸å°åº§æ¨™è¨ˆç®—æœ€æº–
            const stageRect = stage.getBoundingClientRect();
            const cellRect = targetCell.getBoundingClientRect();

            // 4. åœ¨è©²æ ¼å­ç¯„åœå…§éš¨æ©Ÿç”¢ç”Ÿçƒçš„ä½ç½® (ç›¸å°æ–¼è¦–çª—)
            // æ¸›å» 85 æ˜¯çƒçš„å¤§å°å’Œä¸€é»é‚Šè·ï¼Œç¢ºä¿çƒåœ¨æ ¼å­å…§
            const minX = cellRect.left;
            const minY = cellRect.top;
            const maxX = cellRect.right - 85;
            const maxY = cellRect.bottom - 85;

            const randomX = Math.random() * (maxX - minX) + minX;
            const randomY = Math.random() * (maxY - minY) + minY;

            // 5. å®šä½çƒé«” (ä½¿ç”¨ fixed å®šä½ç›¸å°æ–¼è¦–çª—ï¼Œå› ç‚ºå®ƒåœ¨ container å¤–éƒ¨)
            ball.style.position = 'fixed';
            ball.style.left = randomX + "px";
            ball.style.top = randomY + "px";
            
            moveTimer = setTimeout(() => jump(speed), speed);
        }

        // ğŸ¹ å…¨åŸŸéµç›¤ç›£è½
        document.addEventListener('keydown', function(e) {
            if (!active) return;
            
            // ç²å–æŒ‰ä¸‹çš„éµå€¼ (å…¼å®¹ä¸€èˆ¬æ•¸å­—éµå’Œ Numpad æ•¸å­—éµ)
            let pressedKey = e.key;
            // å¦‚æœæ˜¯ Numpad æ•¸å­—ï¼Œåªå–æœ€å¾Œä¸€å€‹æ•¸å­—å­—ç¬¦
            if (pressedKey.startsWith('Numpad')) {
                pressedKey = pressedKey.replace('Numpad', '');
            }

            const ball = document.getElementById('target');
            const ballRect = ball.getBoundingClientRect();
            const centerX = ballRect.left + ballRect.width / 2;
            const centerY = ballRect.top + ballRect.height / 2;

            // åˆ¤æ–·é‚è¼¯
            if (pressedKey === currentTargetKey) {
                // âœ… æŒ‰å°äº†
                pScore++;
                document.getElementById('score').innerText = pScore;
                // è®“å°æ‡‰æ ¼å­é–ƒçˆç¶ å…‰
                document.getElementById('cell-' + pressedKey).classList.remove('correct-hit');
                void document.getElementById('cell-' + pressedKey).offsetWidth; // å¼·åˆ¶é‡ç¹ªä»¥è§¸ç™¼å‹•ç•«
                document.getElementById('cell-' + pressedKey).classList.add('correct-hit');
                // é¡¯ç¤º+1ç‰¹æ•ˆ
                showPopup(centerX, centerY, '+1', 'popup-hit');
                if (pScore >= 7) end(true);
            } else if (allowedKeys.includes(pressedKey)) {
                // âŒ æŒ‰éŒ¯äº† (ä½†æŒ‰çš„æ˜¯æœ‰æ•ˆå€åŸŸå…§çš„éµ)
                if (pScore > 0) { pScore--; document.getElementById('score').innerText = pScore; }
                // èˆå°é–ƒç´…å…‰
                const stage = document.getElementById('game-stage');
                stage.classList.remove('stage-error');
                void stage.offsetWidth; 
                stage.classList.add('stage-error');
                // é¡¯ç¤º-1ç‰¹æ•ˆ
                showPopup(centerX, centerY, '-1', 'popup-miss');
            }
            // å¦‚æœæŒ‰çš„éµä¸åœ¨å…è¨±ç¯„åœå…§ (ä¾‹å¦‚åˆç´šæŒ‰äº† '9')ï¼Œå‰‡ä¸åšåæ‡‰
        });

        function showPopup(x, y, text, typeClass) {
            // ç‰¹æ•ˆç›´æ¥åŠ åœ¨ body ä¸Šï¼Œä½¿ç”¨å›ºå®šå®šä½
            const popup = document.createElement('div');
            popup.className = `popup-effect ${typeClass}`;
            popup.innerText = text;
            popup.style.position = 'fixed';
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 600);
        }

        function end(win) {
            active = false; clearTimeout(moveTimer);
            document.getElementById('result-overlay').style.display = 'flex';
            if (win) {
                document.getElementById('res-title').innerText = "SUCCESS";
                document.getElementById('res-title').style.color = "var(--neon-gold)";
                document.getElementById('res-msg').innerText = "éµç›¤ç¥ç¶“åæ‡‰é€£æ¥æˆåŠŸï¼";
            } else {
                document.getElementById('res-title').innerText = "FAILED";
                document.getElementById('res-title').style.color = "var(--neon-red)";
                document.getElementById('res-msg').innerText = "é€£æ¥ä¸­æ–·ï¼Œè«‹æª¢æŸ¥è¼¸å…¥åæ‡‰ã€‚";
            }
        }
    </script>
</body>
</html>
 
