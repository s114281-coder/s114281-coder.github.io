<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ƒåˆ†æ¥µé™æŒ‘æˆ°è³½</title>
    <style>
        body {
            font-family: sans-serif; background-color: #121218; color: white;
            display: flex; flex-direction: column; align-items: center; padding: 20px;
            margin: 0; overflow-x: hidden;
        }
        /* å€å¡Šå®¹å™¨ */
        .section { width: 100%; max-width: 600px; text-align: center; }
        
        /* è§’è‰²å¡ç‰‡ï¼šé»æ“Šç¯„åœæœ€å¤§åŒ– */
        .card-box {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 20px;
        }
        .role-card {
            background: #252535; border: 2px solid #444; border-radius: 15px;
            padding: 20px 10px; cursor: pointer; transition: 0.2s;
        }
        .role-card:hover { border-color: #00d2ff; background: #303045; }
        
        .circle { width: 60px; height: 60px; border-radius: 50%; margin: 0 auto 10px; pointer-events: none; }
        
        /* éŠæˆ²èˆå° */
        #stage {
            width: 90vw; height: 50vh; max-width: 800px; background: #000;
            border: 3px solid #333; position: relative; margin-top: 20px;
            cursor: crosshair; overflow: hidden; display: none;
        }
        #target {
            width: 80px; height: 80px; border-radius: 50%; position: absolute;
            display: none; cursor: pointer;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { padding: 15px 30px; margin: 10px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 16px; }
        .btn-easy { background: #2ecc71; color: white; }
        .btn-med { background: #f1c40f; color: white; }
        .btn-hard { background: #e74c3c; color: white; }

        /* é™¤éŒ¯è¨Šæ¯æ¬„ */
        #debug-bar {
            position: fixed; bottom: 0; width: 100%; background: rgba(255,0,0,0.2);
            font-size: 12px; color: #aaa; text-align: center; padding: 5px;
        }
    </style>
</head>
<body>

    <div id="step1" class="section">
        <h1>ğŸ§¸ 1. é»é¸ä¸€å€‹è§’è‰²</h1>
        <div class="card-box">
            <div class="role-card" data-color="gold">
                <div class="circle" style="background: gold; box-shadow: 0 0 15px gold;"></div>
                <span>é»ƒé‡‘</span>
            </div>
            <div class="role-card" data-color="cyan">
                <div class="circle" style="background: cyan; box-shadow: 0 0 15px cyan;"></div>
                <span>é’è—</span>
            </div>
            <div class="role-card" data-color="magenta">
                <div class="circle" style="background: magenta; box-shadow: 0 0 15px magenta;"></div>
                <span>æ¡ƒç´…</span>
            </div>
        </div>
    </div>

    <div id="step2" class="section" style="display:none;">
        <h1>âš¡ 2. é¸æ“‡é›£åº¦</h1>
        <button class="btn btn-easy" data-lv="easy">ç°¡å–® (40s)</button>
        <button class="btn btn-med" data-lv="medium">ä¸­ç­‰ (45s)</button>
        <button class="btn btn-hard" data-lv="hard">å›°é›£ (50s)</button>
    </div>

    <div id="info" class="section" style="display:none; font-size: 20px; font-weight: bold; color: #00d2ff; margin-bottom: 10px;">
        æ™‚é–“: <span id="time-txt">0</span>s | åˆ†æ•¸: <span id="score-txt">0</span> / 7
    </div>

    <div id="stage">
        <div id="target"></div>
    </div>

    <div id="debug-bar">ç³»çµ±ç‹€æ…‹: ç­‰å¾…é¸æ“‡è§’è‰²...</div>

    <script>
        // --- è®Šæ•¸å®£å‘Š ---
        let selectedColor = "";
        let score = 0;
        let timeLeft = 0;
        let isPlaying = false;
        let moveTimer, gameTimer;

        const config = {
            easy: { t: 40, spd: 1000, stay: 1800 },
            medium: { t: 45, spd: 700, stay: 1300 },
            hard: { t: 50, spd: 300, stay: 800 }
        };

        // --- æ ¸å¿ƒé‚è¼¯ï¼šæ­¥é©Ÿ 1 è½‰ 2 ---
        document.querySelectorAll('.role-card').forEach(card => {
            card.addEventListener('click', function() {
                selectedColor = this.getAttribute('data-color');
                document.getElementById('debug-bar').innerText = "ç³»çµ±ç‹€æ…‹: å·²é¸æ“‡ " + selectedColor + "ï¼Œæ­£åœ¨åˆ‡æ›...";
                
                // å¼·åˆ¶åˆ‡æ›
                document.getElementById('step1').style.display = 'none';
                document.getElementById('step2').style.display = 'block';
            });
        });

        // --- æ ¸å¿ƒé‚è¼¯ï¼šæ­¥é©Ÿ 2 è½‰ 3 (é–‹å§‹éŠæˆ²) ---
        document.querySelectorAll('.btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const lv = this.getAttribute('data-lv');
                const cfg = config[lv];
                
                document.getElementById('step2').style.display = 'none';
                document.getElementById('info').style.display = 'block';
                document.getElementById('stage').style.display = 'block';
                
                startActualGame(cfg);
            });
        });

        function startActualGame(cfg) {
            isPlaying = true;
            score = 0;
            timeLeft = cfg.t;
            
            const target = document.getElementById('target');
            target.style.backgroundColor = selectedColor;
            target.style.boxShadow = "0 0 20px " + selectedColor;
            target.style.display = "block";
            
            updateUI();
            
            // å€’æ•¸è¨ˆæ™‚
            gameTimer = setInterval(() => {
                timeLeft--;
                updateUI();
                if (timeLeft <= 0) endGame(false);
            }, 1000);

            // ç§»å‹•ç›®æ¨™
            moveTarget(cfg);
        }

        function moveTarget(cfg) {
            if (!isPlaying) return;
            const stage = document.getElementById('stage');
            const target = document.getElementById('target');
            
            const maxX = stage.clientWidth - 80;
            const maxY = stage.clientHeight - 80;
            
            target.style.transition = `all ${cfg.spd/1000}s ease-in-out`;
            target.style.left = Math.floor(Math.random() * maxX) + "px";
            target.style.top = Math.floor(Math.random() * maxY) + "px";

            moveTimer = setTimeout(() => moveTarget(cfg), cfg.stay);
        }

        // é»æ“Šç›®æ¨™
        document.getElementById('target').addEventListener('mousedown', function(e) {
            e.stopPropagation();
            if (!isPlaying) return;
            score++;
            updateUI();
            if (score >= 7) endGame(true);
            else {
                clearTimeout(moveTimer);
                moveTarget(config[Object.keys(config).find(k => config[k].t === timeLeft + (score?0:0)) || 'easy']); // é€™è£¡ç°¡åŒ–è™•ç†
            }
        });

        // é»æ“Šèˆå°æ‰£åˆ†
        document.getElementById('stage').addEventListener('mousedown', function() {
            if (!isPlaying || score <= 0) return;
            score--;
            updateUI();
        });

        function updateUI() {
            document.getElementById('score-txt').innerText = score;
            document.getElementById('time-txt').innerText = timeLeft;
        }

        function endGame(win) {
            isPlaying = false;
            clearInterval(gameTimer);
            clearTimeout(moveTimer);
            alert(win ? "ğŸ† æŒ‘æˆ°æˆåŠŸï¼" : "âŒ› æ™‚é–“åˆ°ï¼Œå¤±æ•—äº†ï¼");
            location.reload();
        }
    </script>
</body>
</html>
        }
    </script>
</body>
</html>
